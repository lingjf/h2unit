CMAKE_MINIMUM_REQUIRED(VERSION 3.0)

PROJECT(h2_unit)

SET(CMAKE_BUILD_TYPE Debug)
SET(CMAKE_CXX_STANDARD 11)

IF(CMAKE_SYSTEM_NAME MATCHES "Windows")
    ADD_COMPILE_OPTIONS(-bigobj)
    ADD_COMPILE_OPTIONS(/W4)
    ADD_COMPILE_OPTIONS(/wd4018)
    ADD_COMPILE_OPTIONS(/wd4100)
    ADD_COMPILE_OPTIONS(/wd4127)
    ADD_COMPILE_OPTIONS(/wd4267)
    ADD_COMPILE_OPTIONS(/wd4244)
    ADD_COMPILE_OPTIONS(/wd4700)
    ADD_COMPILE_OPTIONS(/wd4706)
    ADD_COMPILE_OPTIONS(/wd4819)
    ADD_DEFINITIONS("-D_CRT_SECURE_NO_WARNINGS")
    ADD_DEFINITIONS("-D_WINSOCK_DEPRECATED_NO_WARNINGS")
ELSE()
    ADD_CUSTOM_TARGET(concat ALL
        COMMAND python ${CMAKE_CURRENT_SOURCE_DIR}/../build/concat.py
    )
ENDIF()


AUX_SOURCE_DIRECTORY(. SRC_TEST)
# FILE(GLOB SRC_TEST "test_memory_*.cpp")

ADD_EXECUTABLE(a.out ${SRC_TEST})

IF(CMAKE_SYSTEM_NAME MATCHES "Darwin")
    ADD_CUSTOM_TARGET(fixup ALL
        COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/../fixup.sh a.out
        DEPENDS a.out
    )
ENDIF()
